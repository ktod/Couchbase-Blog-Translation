#The Couchbase Java SDK 2.1.0 arrived!
原文
http://blog.couchbase.com/the-couchbase-java-sdk-2.1.0-arrived

投稿日
February 4, 2015

原著者
Michael Nitschinger

チーム全体を代表して、Couchbase Java SDK 2.1.0がついにリリースされたことをご報告します。
2.1は、2.0に比較して、大量の新しい機能が追加されたとともに、同じぐらい多数の小規模なエンハンスメントやバグフィックスが提供されます。

これは、ますます多くのユーザがアプリケーションをアップグレードすることと同じく、新しいユーザがリアクティブ・データアクセス・パターンを探求したことにより、素晴らしい価値あるフィードバックがもたらされた結果です。

このブログポストでは、私は新しい機能についてフォーカスします。もしも全ての変更点についてチェックしたい場合は、
<a href="http://docs.couchbase.com/developer/java-2.1/release-notes.html">リリースノート</a>を参照してください。質問に関しては、<a href="https://forums.couchbase.com/">フォーラム</a>でいつでも質問できます、また、もしもあなたが、issueであると考えた場合には、我々の<a href="http://issues.couchbase.com/browse/JCBC">JIRA</a>に登録してください。

ところで、私はいくつかの変更点を追加しました、これは、特定のワークロード下ではパフォマンスを改善をもたらします。
本ブログポストには、ベンチマークを掲載していませんが、2.0.3と性能比較すると性能が改善していることを確認できるでしょう。

##SDKの入手方法


リリースバージョンを
<a href="http://search.maven.org/#artifactdetails%7Ccom.couchbase.client%7Cjava-client%7C2.1.0%7Cjar">Maven Central</a> で公開しています。また <a href="http://packages.couchbase.com/clients/java/2.1.0/Couchbase-Java-Client-2.1.0.zip">アーカイブ</a>も提供しています。

dependency.xmlのリンク
```
<script src="https://gist.github.com/daschl/87edfca23b4f52cab4f0.js"></script>
```

本リリースは、N1QL DP4に対するオフィシャルサポート(未だ試験段階ですが)を提供します。これは、DP3との後方互換性を持っていません。なぜならば、基盤となるストリーミングレスポンスが若干変更されたためです。

主な変更点：

* シンプルで、パラメタライズされ、調整されたステートメント
* タイムアウトやスキャン・コンシステンシのような、拡張されたクエリオプション。
* 強化された、同期・非同期のQueryResultによりもたらされる、より柔軟なエラーハンドリング。

サイモンが、素晴らしいブログポストを２週間前にポストしています、もしもこの点について詳しく知りたい方は、ぜひサイモンの<a href="http://blog.couchbase.com/n1ql-dp4-java-sdk">ブログ</a>を参照してください。

##Spatial View Queryのサポート

さらに、View Queryのサポートを追加しました。Couchbase Server 3.0.2では以前として実験的サポートである点に注意してください。しかし、間もなくオフィシャルにサポートが開始される予定です。2.1.0はまた、より古いCouchbase Serverリリースに対してもコンパチブルではありません、理由はレスポンスフォーマットが若干変更されたためです。

簡単な例として、店舗情報を格納する場合を想像してください。：


Spatial Viewで定義できるデータフォーマットをベースにしていて、latitudeとlongitudeのみをインデックスできるだけでなく、店舗の開店時間なども格納できます：


さらに、3次元空間（地理×時刻）に対するクエリも行うことができます。位置情報(Bounding Box)と時間帯情報(Time Range)を条件として、開店している店舗に対する検索を行うことができます。

今後ブログポスト＆サンプルを追加していきます。近い将来に私達は、（Spatial Viewについて）Couchbase Server側でフルサポート版が提供されることを期待できます。


##アイドルサポート(Heartbeats/Keepalive)

特定のソケットへのクライアント接続について、データロードが何も無い場合、フィアーウォール(もしくはその他の機器)が、不要となったコネクションであると判断し、この接続を切断する可能性があります。
これを防ぐため、SDKは、アイドル状態のソケットについて、ハートビート・メッセージを30秒毎に送信しています。これらのメッセージは、もちろんもしも通常のトラフィックが一定のインターバルの内に流れている場合には送信されません。

このインターバルについて、変更することができるようになりました、また、この値を0にすることで、このインタバールを機能停止にすることができるようになりました。


##Pluggableリトライ戦略

多数の方からリクエストされた機能として、リクエストを直ちにディスパッチすることが不可能である場合に、早期に失敗させる方法の提供というものがありました。例えば、ノード障害や、クラスタのフェールオーバの間、ドキュメントの一部（この対象となったノード上に存在する（ドキュメント集合全体のうちの）特定のパーティションについては全てのターゲット（ドキュメント））は、書き込むことができません。デフォルトでは、SDKは、少し後になって、オペレーションをリトライを試み、最終的には呼び出し側のタイムアウトに至るでしょう。

新しい、フェール・ファーストモードでは、これまでに代わり、直ちにリクエストをキャンセルし、（リクエストがリトライすべきか否かを判断可能な）呼び出し側へ、より早期にフィードバック・ループを提供します。
この新しい戦略は、環境上で以下のようなことが可能になるでしょう：

加えて、私たちは、Pluggableなリトライ戦略を用意しました、これにより、開発者自身が（リクエスト処理についての挙動を）独自に定義することができるようになりました。このため本質的に前進しました。本プログポストでは、このトピックについてカバーしていませんが、間も無くドキュメントが提供され、より多くの情報がもたらされるでしょう。
それまでの間、もしも興味があれば、SDKで提供された（ごく単純な）戦略についてチェックだけしてみてください。

最後に、コンフィギュアラブルな"最大リクエスト・ライフタイム"が本環境に追加されました。これは、デフォルトの"ベスト・エフォット"戦略で、リクエストがリトライされるべきか、又はキャンセルされるべきかを決定するために利用されます。
これは、リクエストが非常に長い間繰り返されるのを回避するために、そしてリングバッファ内の貴重なスロットを巻き取るために必要です。

##Subscribable Event Bus
アプリケーションのサブスクライバに対して、コアとクライアントでイベントを発行するために使用できるジェネリック・イベントバス(A generic event bus)が環境に追加されました。
現在、Bucketのオープン／クローズと、ノードの接続／切断イベントのみ発行されます。しかし、将来的には、パフォーマンス測定値や他のタイプのイベントやワーニングを発行するように、ジェネリック・イベント使用を大幅に拡大させてゆく計画です。

これはサブスクライブや、この種のイベントに対してリアクトすることが非常に容易で、RxJavaや我々のObservablesのストリーミング特性の恩恵を享受できます。


##DNS SRV Bootstrap
DNS SRVレコードを通して、Bootstrapノードのリストをフェッチすることが可能になりました。
これは、システム管理者が、非常に簡単な手続きで、ブーロラップリストを中央管理することを可能にします。
Couchbase Serverの設定を変更してこの機能を有効にする必要があります。以下の情報を参照ください。


##What's next?
私たちは、2.2リリースに向けて多くのアイデアを持っています。私は、このブランチの安定化に向けた必要なバグフィックスについても計画を進めています。加えて、さらにエンハンスされたフレームワークにシフトし、機能のインテグレーションを積み重ね（up the stack）ています。
引き続き今後のブログポスト／アナウンスにご注目ください。
